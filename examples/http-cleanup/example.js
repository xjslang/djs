let http=require("http");let fs=require("fs");function fetchUserData() {let defers_d55h6lpmoqs6a281kaqg=[];try{let logFile=fs.openSync("request.log","w");defers_d55h6lpmoqs6a281kaqg.push(() =>{fs.closeSync(logFile)});defers_d55h6lpmoqs6a281kaqg.push(() =>{console.log("✓ Log file closed")});let agent=new http.Agent({keepAlive:true,maxSockets:10});defers_d55h6lpmoqs6a281kaqg.push(() =>{agent.destroy()});defers_d55h6lpmoqs6a281kaqg.push(() =>{console.log("✓ HTTP agent destroyed\n")});fs.writeSync(logFile,`[${new Date().toISOString()}] Starting HTTP request\n`);console.log("Starting HTTP cleanup example...");console.log("Fetching data from local server (http://localhost:3000)\n");makeRequest("http://localhost:3000/api/users/123",agent,logFile,function(userData,error){if (error){console.error("Failed to fetch user data:",error.message);console.error("Make sure to run: npm run server");return};console.log(`✓ User: ${userData.name} (${userData.email})`);makeRequest(`http://localhost:3000/api/users/${userData.id}/posts`,agent,logFile,function(posts,error){if (error){console.error("Failed to fetch posts:",error.message);return};console.log(`✓ Found ${posts.length} posts:\n`);posts.forEach(function(post){console.log(`  - ${post.title}`)});console.log("\n✓ Requests completed");console.log("✓ Cleanup will happen via defer statements...\n")})})}finally{for(let i_d55h6lpmoqs6a281kaqg=defers_d55h6lpmoqs6a281kaqg.length;i_d55h6lpmoqs6a281kaqg>0;i_d55h6lpmoqs6a281kaqg--){try{defers_d55h6lpmoqs6a281kaqg[i_d55h6lpmoqs6a281kaqg-1]()}catch(e_d55h6lpmoqs6a281kaqg){console.log(e_d55h6lpmoqs6a281kaqg)}}}};function makeRequest(url,agent,logFile,callback){let urlObj=require("url").parse(url);fs.writeSync(logFile,`[${new Date().toISOString()}] GET ${url}\n`);let options={agent:agent,hostname:urlObj.hostname,method:"GET",path:urlObj.path,port:urlObj.port,timeout:5000};let req=http.request(options,function(res){let data="";res.on("data",function(chunk){data=(data+chunk)});res.on("end",function(){fs.writeSync(logFile,`[${new Date().toISOString()}] Response: ${res.statusCode}\n`);if (((res.statusCode>=200)&&(res.statusCode<300))){callback(JSON.parse(data),null)} else {callback(null,new Error(`HTTP ${res.statusCode}: ${res.statusMessage}`))}})});req.on("error",function(err){fs.writeSync(logFile,`[${new Date().toISOString()}] Error: ${err.message}\n`);callback(null,err)});req.on("timeout",function(){req.destroy();callback(null,new Error("Request timeout"))});req.end()};fetchUserData();setTimeout(function(){console.log("Note: defer statements executed when fetchUserData() returned");console.log("Check request.log for the full request log")},1000)